<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Live Stream</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: #fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; overflow-x: hidden; }
        .player-box { 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            background: #000; 
            width: 100%; 
            aspect-ratio: 16/9; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.8);
        }
        iframe { width: 100%; height: 100%; border: none; }
        .channel-item { 
            border-bottom: 1px solid #111; 
            transition: all 0.2s ease;
        }
        .channel-item:active { background: #1a1a1a; transform: scale(0.98); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        footer { 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            background: rgba(10, 10, 10, 0.98); 
            backdrop-filter: blur(15px);
            border-top: 1px solid #222; 
            height: 70px; 
            display: flex; 
            align-items: center; 
            padding: 0 20px; 
            z-index: 1000;
        }

        .img-container {
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #111;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #222;
        }

        .channel-logo {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body class="pb-24">

    <!-- Video Player -->
    <div class="player-box">
        <iframe id="vid-player" src="about:blank" allowfullscreen sandbox="allow-same-origin allow-scripts"></iframe>
    </div>

    <!-- Controls Section -->
    <div class="p-4 sticky top-[56.25vw] bg-[#050505] z-50 border-b border-zinc-900">
        <div class="relative mb-3">
            <input type="text" id="search" placeholder="Search UK & US Channels..." 
                class="w-full bg-zinc-900 border border-zinc-800 rounded-xl p-4 pl-11 text-white outline-none focus:border-blue-600 transition-all text-sm">
            <svg class="w-5 h-5 absolute left-4 top-1/2 -translate-y-1/2 text-zinc-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
        </div>
        <div class="flex gap-2">
            <button onclick="setFilter('all')" id="btn-all" class="px-4 py-1.5 rounded-full text-xs font-bold bg-blue-600 text-white transition-colors">ALL</button>
            <button onclick="setFilter('gb')" id="btn-gb" class="px-4 py-1.5 rounded-full text-xs font-bold bg-zinc-800 text-zinc-400 transition-colors">UK</button>
            <button onclick="setFilter('us')" id="btn-us" class="px-4 py-1.5 rounded-full text-xs font-bold bg-zinc-800 text-zinc-400 transition-colors">USA</button>
        </div>
    </div>

    <!-- Channel List -->
    <div id="list" class="flex flex-col px-2 mt-2">
        <div class="p-20 text-center">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500 mb-4"></div>
            <p class="text-zinc-500 font-medium">Loading Streams...</p>
        </div>
    </div>

    <!-- Footer Info -->
    <footer>
        <div class="flex items-center gap-4 w-full">
            <div id="active-indicator" class="w-3 h-3 rounded-full bg-zinc-800"></div>
            <div class="flex flex-col truncate">
                <span class="text-[10px] text-zinc-500 font-black uppercase tracking-widest">ON AIR</span>
                <span id="current-info" class="text-sm font-bold truncate text-zinc-300">Select a channel to begin</span>
            </div>
        </div>
    </footer>

    <script>
        const player = document.getElementById('vid-player');
        const listContainer = document.getElementById('list');
        const searchInput = document.getElementById('search');
        const footerInfo = document.getElementById('current-info');
        const activeIndicator = document.getElementById('active-indicator');

        let dataStore = [];
        let currentRegion = 'all';

        async function load() {
            try {
                const res = await fetch('https://api.cdn-live.tv/api/v1/channels/?user=cdnlivetv&plan=free');
                const data = await res.json();
                
                // Process and filter data
                dataStore = data.channels.filter(c => {
                    const name = c.name.toLowerCase();
                    const code = c.code.toLowerCase();
                    
                    // Exclude specific content
                    const isSports = name.includes('sport') || name.includes('racing') || name.includes('football') || name.includes('liga');
                    const isHub = name.includes('hubpremier') || name.includes('hub premier');
                    const isSkyNews = name.includes('sky news');

                    // Region logic: Keep UK (gb) and US (us)
                    const isTargetRegion = (code === 'gb' || code === 'us');
                    
                    if (!isTargetRegion) return false;
                    if (isSports || isHub) return false;
                    
                    // Specific UK removals
                    if (code === 'gb' && isSkyNews) return false;

                    return true;
                });

                if (dataStore.length > 0) {
                    render(dataStore);
                } else {
                    listContainer.innerHTML = '<div class="p-10 text-center text-zinc-500">No channels found.</div>';
                }
            } catch (e) {
                listContainer.innerHTML = '<div class="p-10 text-center text-red-500">Failed to connect to stream server.</div>';
            }
        }

        function setFilter(region) {
            currentRegion = region;
            // Update UI buttons
            ['all', 'gb', 'us'].forEach(r => {
                const btn = document.getElementById(`btn-${r}`);
                if (r === region) {
                    btn.classList.replace('bg-zinc-800', 'bg-blue-600');
                    btn.classList.replace('text-zinc-400', 'text-white');
                } else {
                    btn.classList.replace('bg-blue-600', 'bg-zinc-800');
                    btn.classList.replace('text-white', 'text-zinc-400');
                }
            });
            filter();
        }

        function selectChannel(ch) {
            player.src = ch.url;
            footerInfo.innerText = ch.name;
            footerInfo.className = 'text-sm font-bold truncate text-blue-400';
            activeIndicator.className = 'w-3 h-3 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.6)] animate-pulse';
            
            document.querySelectorAll('.channel-item').forEach(el => el.classList.remove('bg-zinc-900', 'border-blue-900/30'));
            const activeEl = document.getElementById(`ch-${ch.id}`);
            if (activeEl) activeEl.classList.add('bg-zinc-900', 'border-blue-900/30');
        }

        function render(channels) {
            listContainer.innerHTML = '';
            channels.forEach(ch => {
                const div = document.createElement('div');
                div.id = `ch-${ch.id}`;
                div.className = 'channel-item flex items-center p-4 gap-4 cursor-pointer rounded-2xl mx-2 mb-2 border border-transparent';
                
                // Remove placeholder if no image exists
                const imageHtml = ch.image && ch.image !== "" 
                    ? `<img src="${ch.image}" class="channel-logo" onerror="this.style.display='none'">` 
                    : ``;

                div.innerHTML = `
                    <div class="img-container">
                        ${imageHtml}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="font-bold text-base text-zinc-100 truncate">${ch.name}</div>
                        <div class="text-[10px] text-zinc-500 font-bold uppercase tracking-tight">
                            ${ch.code === 'gb' ? 'United Kingdom' : 'United States'} â€¢
                        </div>
                    </div>
                    <div class="flex items-center justify-center w-10 h-10 rounded-full bg-zinc-900 text-zinc-600">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M4.555 5.168A1 1 0 003 6.07v7.86a1 1 0 001.555.832l6.666-3.93a1 1 0 000-1.664l-6.666-3.93z"></path></svg>
                    </div>
                `;
                div.onclick = () => {
                    selectChannel(ch);
                    window.scrollTo({top: 0, behavior: 'smooth'});
                };
                listContainer.appendChild(div);
            });
        }

        function filter() {
            const s = searchInput.value.toLowerCase();
            const filtered = dataStore.filter(ch => {
                const matchesSearch = ch.name.toLowerCase().includes(s);
                const matchesRegion = currentRegion === 'all' || ch.code.toLowerCase() === currentRegion;
                return matchesSearch && matchesRegion;
            });
            render(filtered);
        }

        searchInput.addEventListener('input', filter);

        // Run application
        load();
    </script>
</body>
</html>

